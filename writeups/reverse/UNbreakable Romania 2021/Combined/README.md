# Combined (rev)

# Challenge description:

There are not that many combinations one can do here.

NOTE: The format of the flag is CTF{}, for example: CTF{foobar}. The flag must be submitted in full, including the CTF and curly bracket parts.

# Flag proof:

> CTF{fe402183ea30417f5d333b40c22d9b26c1aebed4}
> 

# Summary:

The binary reads some data, then checks it using a validator. If the validator passes, it displays that the authentication is successful (and we have the flag). It can easily be solved by understanding the algorithm

# Details:

Let's open the binary in IDA. We see two functions:

- main

```c
int __cdecl main(int argc, const char **argv, const char **envp)
{
  int var498324; // [rsp+2Ch] [rbp-14h] BYREF
  char *var389534[2]; // [rsp+30h] [rbp-10h] BYREF

  var389534[1] = (char *)__readfsqword(0x28u);
  printf("Please enter validation: ");
  var498324 = 0;
  var498324 = getline(var389534, (size_t *)&var498324, stdin);
  var389534[0][var498324 - 1] = 0;
  puts("Verifying your authentication");
  if ( (unsigned int)validator((__int64)var389534[0]) == 1 )
    puts("Correct authentication received");
  else
    puts("ERROR: Invalid authentication!");
  return 0;
}
```

- validator

```c
__int64 __fastcall validator(__int64 param_1)
{
  int var2341; // [rsp+14h] [rbp-4h]

  for ( var2341 = 0; ; ++var2341 )
  {
    if ( var2341 > 29 )
      return 1;
    if ( (int8_t *)*(char *)(var2341 + param_1) != &verify[36 * var2341] )
      break;
  }
  return (unsigned int)-1;
}
```

We also see the `verify` variable:

```c
.data:0000000000004020 verify          db '0x430xf10x250x0b0xac0xa20x2e0xb60xb20x540x3a0x7d0x4f0x6e0x1d0x2e0'
.data:0000000000004020                                         ; DATA XREF: validator+50â†‘o
.data:0000000000004020                 db 'x7e0xd10x460x8a0x080xa30x600x970x330x8b0x1a0x7b0xb70x8c0x4a0x820x'
.data:0000000000004020                 db '2f0x9b0xb10x440x660xc90x510xd30x9c0x4b0x690xde0x0c0x650x050x6a0x4'
.data:0000000000004020                 db 'f0x370x170x000x670x230x340x110xf00x6d0x650x810x400xc80xc90x300xa7'
.data:0000000000004020                 db '0xd30x4e0xc50xc00x0d0x2f0x970x320x5f0x1b0xbe0x250x1a0x260x580x050'
.data:0000000000004020                 db 'x310xa80x290x090x9e0xf60xb60xbc0x680x380xf50xc40x360x810x290xdc0x'
.data:0000000000004020                 db '650x440x330x8e0x310x890x6d0x220xda0x920x870x650x570xe20x100x580x3'
.data:0000000000004020                 db '50x2e0x650xc80x610xc50x100x200x6f0x450x800x2a0xc50x330x420xcc0xd8'
.data:0000000000004020                 db '0xf30xc00x590xfb0x7a0x300x3c0xed0xef0xdf0x020xb20x210x1a0x340x4c0'
.data:0000000000004020                 db 'xfb0x520x020x2f0x4a0xd30x8a0x310xab0xf30x1b0x0a0x570xcc0x7e0xec0x'
.data:0000000000004020                 db '370x5c0xa20xe90x6b0xbb0x470x490x550x660xef0x040x390xde0x150xc30xf'
.data:0000000000004020                 db '00x970x350xfd0x470x280xcd0x330x380x2a0x8e0x640x290xa30x910xf60x9e'
.data:0000000000004020                 db '0xd60xee0x860x330xb40xbd0x5b0xa70x6b0xfd0xfd0x020x330x440xfd0x1f0'
.data:0000000000004020                 db 'x5d0x4b0xe20x9c0x1f0x330x2e0x910xf50x830xe60x970xad0x0b0x620x190x'
.data:0000000000004020                 db '580xb40x650xc60x8c0xcc0x840x340x630xcd0xcc0xd30xdf0xec0x6a0xfa0x3'
.data:0000000000004020                 db '00x530x290x4e0x970x1d0x530x6f0x610x630xd50x6a0x1a0x1d0xdf0xea0x58'
.data:0000000000004020                 db '0xcf0x320x2e0x860x7b0x990x2b0x940x780xf40x320xce0x150x360x960x930'
.data:0000000000004020                 db 'x540x330xa50x640x5d0xe20x470x8d0x690xa00xf80xe90x390xbb0x010xdb0x'
.data:0000000000004020                 db '1e0xd70x8a0x5c0xba0x620xaf0x700x410xcd0x7e0x440xf50x090x320xad0xb'
.data:0000000000004020                 db '30x970xce0x680xfc0x3b0xe90x360x2b0xea0x930x900x3f0x0b0xd50xe00x63'
.data:0000000000004020                 db '0x610x6b0x9f0x790x480x430x680x320x310x020xc10xf40x390xec0x3b0x0c0'
.data:0000000000004020                 db 'xde0x610x080xa60x3a0x880xb60x080xb90x490x650x0d0x920x7e0x210x140x'
.data:0000000000004020                 db '170xeb0xe30x620xea0xfb0x7f0x0e0x830x210xf60x1d0x650xcc0x4d0x510x9'
.data:0000000000004020                 db '70x010x060xb30x7d0x640x7b0x590x300xdb0x050x310xde0x590x340x150xe6'
.data:0000000000004020                 db '0x270xdf0x900x180x5e0x3b0x7d0x830x430xe80x780x2d0x2d0x0c0x530x870'
.data:0000000000004020                 db 'xd10xa20x340x2a0x140xfa0xb30x470xd10x190x870xb40x7f0xb80xe30xc40x'
.data:0000000000004020                 db 'f10xb50x940x8b0xaa0x590x850xa30x040x7a0x610xe50x860xe70x410x650x3'
.data:0000000000004020                 db '00xec0x4f0x610x860x4c0x2f0x5a0x0b0x420x760x20'
```

Let's analyze the algorithm inside `validator`. It has a loop with 29 iterations and verifies the byte at position `i` from the input with the byte at position `36 * i` from `verify`. I realized that every 36th byte is 0 (followed by `x`), so I didn't spend much time examining the algorithm, but I tried to put together every 36th byte from `verify`, decoded in base 10 and transformed into a character

```python
s = '0x430xf10x250x0b0xac0xa20x2e0xb60xb20x540x3a0x7d0x4f0x6e0x1d0x2e0' + \
    'x7e0xd10x460x8a0x080xa30x600x970x330x8b0x1a0x7b0xb70x8c0x4a0x820x' + \
    '2f0x9b0xb10x440x660xc90x510xd30x9c0x4b0x690xde0x0c0x650x050x6a0x4' + \
    'f0x370x170x000x670x230x340x110xf00x6d0x650x810x400xc80xc90x300xa7' + \
    '0xd30x4e0xc50xc00x0d0x2f0x970x320x5f0x1b0xbe0x250x1a0x260x580x050' + \
    'x310xa80x290x090x9e0xf60xb60xbc0x680x380xf50xc40x360x810x290xdc0x' + \
    '650x440x330x8e0x310x890x6d0x220xda0x920x870x650x570xe20x100x580x3' + \
    '50x2e0x650xc80x610xc50x100x200x6f0x450x800x2a0xc50x330x420xcc0xd8' + \
    '0xf30xc00x590xfb0x7a0x300x3c0xed0xef0xdf0x020xb20x210x1a0x340x4c0' + \
    'xfb0x520x020x2f0x4a0xd30x8a0x310xab0xf30x1b0x0a0x570xcc0x7e0xec0x' + \
    '370x5c0xa20xe90x6b0xbb0x470x490x550x660xef0x040x390xde0x150xc30xf' + \
    '00x970x350xfd0x470x280xcd0x330x380x2a0x8e0x640x290xa30x910xf60x9e' + \
    '0xd60xee0x860x330xb40xbd0x5b0xa70x6b0xfd0xfd0x020x330x440xfd0x1f0' + \
    'x5d0x4b0xe20x9c0x1f0x330x2e0x910xf50x830xe60x970xad0x0b0x620x190x' + \
    '580xb40x650xc60x8c0xcc0x840x340x630xcd0xcc0xd30xdf0xec0x6a0xfa0x3' + \
    '00x530x290x4e0x970x1d0x530x6f0x610x630xd50x6a0x1a0x1d0xdf0xea0x58' + \
    '0xcf0x320x2e0x860x7b0x990x2b0x940x780xf40x320xce0x150x360x960x930' + \
    'x540x330xa50x640x5d0xe20x470x8d0x690xa00xf80xe90x390xbb0x010xdb0x' + \
    '1e0xd70x8a0x5c0xba0x620xaf0x700x410xcd0x7e0x440xf50x090x320xad0xb' + \
    '30x970xce0x680xfc0x3b0xe90x360x2b0xea0x930x900x3f0x0b0xd50xe00x63' + \
    '0x610x6b0x9f0x790x480x430x680x320x310x020xc10xf40x390xec0x3b0x0c0' + \
    'xde0x610x080xa60x3a0x880xb60x080xb90x490x650x0d0x920x7e0x210x140x' + \
    '170xeb0xe30x620xea0xfb0x7f0x0e0x830x210xf60x1d0x650xcc0x4d0x510x9' + \
    '70x010x060xb30x7d0x640x7b0x590x300xdb0x050x310xde0x590x340x150xe6' + \
    '0x270xdf0x900x180x5e0x3b0x7d0x830x430xe80x780x2d0x2d0x0c0x530x870' + \
    'xd10xa20x340x2a0x140xfa0xb30x470xd10x190x870xb40x7f0xb80xe30xc40x' + \
    'f10xb50x940x8b0xaa0x590x850xa30x040x7a0x610xe50x860xe70x410x650x3' + \
    '00xec0x4f0x610x860x4c0x2f0x5a0x0b0x420x760x20'

for i in range(29):
    print(chr(int(s[36 * i + 2] + s[36 * i + 3], 16)), end="")
```

Output:

```c
CTF{fe402183ea30417f5d333b40c
```

Looks like a partial flag. Let's increase the number of iterations:

```c
CTF{fe402183ea30417f5d333b40c22d9b26c1aebed4}
```